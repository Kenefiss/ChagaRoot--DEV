var huicalendar = function(t, e) {
  this.element = t, this.enabledDay = e.enabledDay, this.viewDay = e.viewDay || new Date, this.year = this.viewDay.getFullYear(), this.month = this.viewDay.getMonth(), this.monthArr = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"], this.getCalendar(), this.bindEvent()
};
huicalendar.prototype = {
  getCalendar: function() {
    for (var t = [31, this.year % 4 == 0 && this.year % 100 != 0 || this.year % 400 == 0 ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][this.month], e = new Date(this.year + "/" + (this.month + 1) + "/1"), a = new Date(this.year + "/" + (this.month + 1) + "/" + t), n = e.getDay(), h = a.getDay(), r = [], i = n - 1; i >= 0; i--) r.push("");
    for (i = 1; i <= t; i++) r.push(i);
    for (i = h + 1; i < 7; i++) r.push("");
    var s = "";
    for (i = 0; i < r.length; i++) s += i % 7 == 0 ? '<tr> <td class="' + (-1 == $.inArray(r[i], this.enabledDay) ? "" : "enabled") + '">' + r[i] + "</td>" : i % 7 == 6 ? '<td class="' + (-1 == $.inArray(r[i], this.enabledDay) ? "" : "enabled") + '">' + r[i] + "</td> </tr>" : '<td class="' + (-1 == $.inArray(r[i], this.enabledDay) ? "" : "enabled") + '">' + r[i] + "</td>";
    var l = "<ul>";
    for (i = 0; i < this.monthArr.length; i++) l += '<li value="' + i + '" class="' + (1 == i ? "border-top1" : "") + '">' + this.monthArr[i] + "</li>";
    l += "</ul>";
    var o = '<table class="calendar" cellspacing="0">' + ('<thead><tr><th colspan="7"><div class="controls"><span class="left"></span><span class="month" month="' + (this.month + 1) + '">' + this.monthArr[this.month] + l + '</span><span class="year" year="' + this.year + '">' + this.year + '</span><span class="right"></span></div></th></tr><tr class="week"><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead>') + "<tbody>" + s + "</tbody></table>";
    this.element.html(o)
  },
  bindEvent: function() {
    var t = this;
    this.element.on("click", ".left", (function() {
      t.month--, -1 == t.month && (t.month = 11, t.year--, 1900 == t.year && (t.year++, t.month++)), t.getCalendar(), t.element.trigger({
        type: "changeMonth",
        month: parseInt(t.month) + 1,
        year: parseInt(t.year)
      })
    })), this.element.on("click", ".right", (function() {
      t.month++, 12 == t.month && (t.month = 0, t.year++), t.getCalendar(), t.element.trigger({
        type: "changeMonth",
        month: parseInt(t.month) + 1,
        year: parseInt(t.year)
      })
    })), this.element.on("click", ".month", (function() {
      $(this).find("ul").toggle()
    })), this.element.on("click", ".month li", (function() {
      var e = $(this).attr("value");
      t.month = e, t.getCalendar(), t.element.trigger({
        type: "changeMonth",
        month: parseInt(t.month) + 1,
        year: parseInt(t.year)
      })
    })), this.element.on("click", ".enabled", (function() {
      t.element.trigger({
        type: "changeDate",
        date: $(this).html(),
        month: parseInt(t.month) + 1,
        year: parseInt(t.year)
      })
    }))
  }
}, $.fn.huicalendar = function(t, e) {
  if ("update" == e) {
    (a = $(this).data("huicalendar")).enabledDay = t.enabledDay, a.viewDay = t.viewDay || new Date, a.year = a.viewDay.getFullYear(), a.month = a.viewDay.getMonth(), a.getCalendar()
  } else {
    var a = new huicalendar(this, t);
    $(this).data("huicalendar", a)
  }
  return this
};